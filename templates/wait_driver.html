{% extends "base.html" %}
{% block title %}Ride Status{% endblock %}
{% block content %}

<style>
  .wait-card {
    max-width: 700px;
    margin: 40px auto;
    background: #ffffff;
    padding: 24px 28px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.06);
    font-family: Arial, Helvetica, sans-serif;
  }

  .wait-card h1 {
    margin-top: 0;
    margin-bottom: 8px;
  }

  .wait-card h2 {
    margin-top: 0;
  }

  .addresses {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 16px;
  }

  .addr {
    padding: 12px;
    border-radius: 8px;
    background: #fbfbfd;
    border: 1px solid #eee;
  }

  .meta {
    margin-top: 14px;
    color: #555;
  }

  .small {
    font-size: 0.85rem;
    color: #777;
  }

  .loader {
    margin: 24px auto;
    width: 80px;
    height: 80px;
    position: relative;
  }

  .dot {
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #007bff;
    position: absolute;
    animation: spin 1s linear infinite;
  }

  .dot:nth-child(2) {
    transform: rotate(120deg) translate(28px);
    animation-delay: -0.16s;
  }

  .dot:nth-child(3) {
    transform: rotate(240deg) translate(28px);
    animation-delay: -0.32s;
  }

  @keyframes spin {
    0%   { transform: rotate(0deg) translate(28px); }
    100% { transform: rotate(360deg) translate(28px); }
  }

  .driver-card {
    margin-top: 20px;
    padding: 14px;
    border-radius: 8px;
    background: #f4f9ff;
    border: 1px solid #d2e4ff;
  }

  .btn-row {
    margin-top: 18px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .btn {
    display: inline-block;
    padding: 8px 14px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 0.9rem;
  }

  .btn-cancel {
    background: #dc3545;
    color: #fff;
  }
</style>

<div class="wait-card">

  {# Dynamic heading based on ride status #}
  {% if ride['status'] == 'waiting' %}
    <h1>Looking for a Driver…</h1>
    <p>We’re matching you with the nearest available driver. You don’t need to enter your trip details again.</p>
  {% elif ride['status'] == 'accepted' %}
    <h1>Driver on the Way…</h1>
    <p>Your request has been <strong>accepted</strong>. Please wait for your driver to arrive.</p>
  {% elif ride['status'] == 'picked_up' %}
    <h1>Enjoy Your Ride</h1>
    <p>You have been <strong>picked up</strong> by the driver. Sit back and relax until you reach your destination.</p>
  {% elif ride['status'] == 'completed' %}
    <h1>Trip Completed</h1>
    <p>Your ride is finished. You can request a new ride from the passenger dashboard.</p>
  {% elif ride['status'] == 'cancelled' %}
    <h1>Ride Cancelled</h1>
    <p>This ride was cancelled. You can make a new request from the passenger dashboard.</p>
  {% else %}
    <h1>Ride Status</h1>
    <p>We’re tracking your ride. Please wait a moment…</p>
  {% endif %}

  <p class="small">Ride ID: {{ ride['id'] }}</p>

  {% if ride['status'] in ['waiting', 'accepted', 'picked_up'] %}
    <div class="loader">
      <div class="dot"></div>
      <div class="dot"></div>
      <div class="dot"></div>
    </div>
  {% endif %}

  <div class="addresses">
    <div class="addr">
      <h2>Pickup</h2>
      <p>{{ ride['pickup_address'] }}</p>
    </div>
    <div class="addr">
      <h2>Dropoff</h2>
      <p>{{ ride['dropoff_address'] }}</p>
    </div>
  </div>

  {% if ride['notes'] %}
    <div class="meta">
      <p><strong>Notes:</strong> {{ ride['notes'] }}</p>
    </div>
  {% endif %}

  {# DRIVER & VEHICLE INFO (only once a driver is assigned) #}
  <div class="driver-card">
    <h2>Driver & Vehicle</h2>
    {% if driver %}
      <p><strong>Driver:</strong> {{ driver['driver_name'] }}</p>
      <p><strong>Vehicle:</strong> {{ driver['vehicle_info'] }}</p>
      <p><strong>License Number:</strong> {{ driver['license_number'] }}</p>
    {% else %}
      <p>No driver assigned yet. You’ll see the driver details here once someone accepts your ride.</p>
    {% endif %}
  </div>

  <div class="meta">
    {% if ride['estimated_time_minutes'] %}
      <p>Estimated time for driver arrival:
        <strong>{{ ride['estimated_time_minutes'] }} minutes</strong>
      </p>
    {% else %}
      <p>Estimated time for driver arrival: <strong>Pending</strong></p>
    {% endif %}

    <p class="small">
      Current status:
      <strong>{{ ride['status'] or 'requested' }}</strong>
    </p>
  </div>

  <div class="btn-row">
    {# Passenger can cancel while the ride is not yet completed/picked up #}
    {% if ride['status'] in ['waiting', 'accepted'] %}
      <form action="{{ url_for('passenger_cancel_ride', ride_id=ride['id']) }}" method="POST">
        <button type="submit" class="btn btn-cancel">Cancel Ride</button>
      </form>
    {% endif %}
  </div>

</div>

{% endblock %}
