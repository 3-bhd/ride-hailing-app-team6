{% extends "base.html" %}

{% block title %}Admin â€“ Driver Management | U-Ride{% endblock %}

{% block content %}
<div class="card">
    <h2 class="card-title">Driver Management</h2>

    {% with messages = get_flashed_messages() %}
    {% if messages %}
        <div class="flash flash-success">
            {% for message in messages %}
                <p>{{ message }}</p>
            {% endfor %}
        </div>
    {% endif %}
    {% endwith %}

    <h3>Pending Drivers ({{ pending_drivers|length }})</h3>

    {% if pending_drivers %}
        {% for driver in pending_drivers %}
            <div class="driver-card">
                <div class="driver-header">
                    <h4>{{ driver.name }}</h4>
                    <span class="badge badge-pending">Pending</span>
                </div>

                <div class="driver-details">
                    <p><strong>Email:</strong> {{ driver.email }}</p>
                    <p><strong>Phone:</strong> {{ driver.phone }}</p>
                    <p><strong>License Number:</strong> {{ driver.license_number }}</p>
                    <p><strong>Vehicle Info:</strong> {{ driver.vehicle_info }}</p>
                </div>

                <div class="documents">
                    <strong>Documents:</strong>
                    <ul>
                        <li><a href="{{ url_for('serve_uploaded_file', filename=driver.id_doc_path) }}" target="_blank">ID Document</a></li>
                        <li><a href="{{ url_for('serve_uploaded_file', filename=driver.license_doc_path) }}" target="_blank">License Document</a></li>
                        <li><a href="{{ url_for('serve_uploaded_file', filename=driver.vehicle_doc_path) }}" target="_blank">Vehicle Document</a></li>
                    </ul>
                </div>

                <div class="actions">
                    <form action="{{ url_for('admin_approve', driver_id=driver.driver_id) }}" method="POST">
                        <button type="submit" class="btn btn-approve">Approve</button>
                    </form>
                    <form action="{{ url_for('admin_reject', driver_id=driver.driver_id) }}" method="POST">
                        <button type="submit" class="btn btn-reject">Reject</button>
                    </form>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <p>No pending drivers for approval.</p>
        </div>
    {% endif %}
</div>

{% if approved_drivers %}
<div class="card" style="margin-top: 1.5rem;">
    <h3 class="card-title">Approved Drivers ({{ approved_drivers|length }})</h3>
    {% for driver in approved_drivers %}
        <div class="driver-card">
            <div class="driver-header">
                <h4>{{ driver.name }}</h4>
                <span class="badge badge-approved">Approved</span>
            </div>
            <div class="driver-details">
                <p><strong>Email:</strong> {{ driver.email }}</p>
                <p><strong>Phone:</strong> {{ driver.phone }}</p>
                <p><strong>License Number:</strong> {{ driver.license_number }}</p>
                <p><strong>Vehicle Info:</strong> {{ driver.vehicle_info }}</p>
            </div>
        </div>
    {% endfor %}
</div>
{% endif %}

{% if rejected_drivers %}
<div class="card" style="margin-top: 1.5rem;">
    <h3 class="card-title">Rejected Drivers ({{ rejected_drivers|length }})</h3>
    {% for driver in rejected_drivers %}
        <div class="driver-card">
            <div class="driver-header">
                <h4>{{ driver.name }}</h4>
                <span class="badge badge-rejected">Rejected</span>
            </div>
            <div class="driver-details">
                <p><strong>Email:</strong> {{ driver.email }}</p>
                <p><strong>Phone:</strong> {{ driver.phone }}</p>
                <p><strong>License Number:</strong> {{ driver.license_number }}</p>
                <p><strong>Vehicle Info:</strong> {{ driver.vehicle_info }}</p>
            </div>
        </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
